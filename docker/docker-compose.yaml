services:
  anvil-a:
    image: ghcr.io/foundry-rs/foundry:latest
    container_name: anvil-a
    platform: linux/amd64
    command: ["anvil --host 0.0.0.0 --chain-id 31337"]
    ports:
      - "127.0.0.1:8545:8545"
  anvil-b:
    image: ghcr.io/foundry-rs/foundry:latest
    container_name: anvil-b
    platform: linux/amd64
    command: ["anvil --host 0.0.0.0 --chain-id 31338"]
    ports:
      - "127.0.0.1:8546:8545"
  anvil-c:
    image: ghcr.io/foundry-rs/foundry:latest
    container_name: anvil-c
    platform: linux/amd64
    command: ["anvil --host 0.0.0.0 --chain-id 31339"]
    ports:
      - "127.0.0.1:8547:8545"
  wsproxy:
    image: jwnmulder/websockify:0.12
    container_name: wsproxy
    platform: linux/amd64
    ports:
      - "127.0.0.1:55688:80" 
    command: "80 api.x.com:443"
  notary-server:
    image: ghcr.io/tlsnotary/tlsn/notary-server:v0.1.0-alpha.7
    container_name: notary-server
    ports:
      - "127.0.0.1:7047:7047"
  contracts:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      target: vlayer-contracts
    volumes:
      - ../contracts:/src:rw
    command: ["-c", "cp -r /home/vlayer/contracts/vlayer /src"]
  vlayer:
    depends_on:
      - anvil-a
      - anvil-b
      - anvil-c
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: vlayer
    environment:
      RUST_LOG: "info,call_engine=debug"
    command: "/home/vlayer/vlayer serve --proof fake --host 0.0.0.0 --rpc-url 31337:http://anvil-a:8545 --rpc-url 31338:http://anvil-b:8545 --rpc-url 31339:http://anvil-c:8545"
    ports:
      - "127.0.0.1:3000:3000"
